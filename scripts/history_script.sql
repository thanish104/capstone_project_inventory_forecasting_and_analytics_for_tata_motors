CREATE TABLE IF NOT EXISTS DEV_DB.HISTORY_DNA.HISTORY_INVENTORY_TRANSACTION LIKE DEV_DB.CLEANSED_DNA.CLEANSED_INVENTORY_TRANSACTION;


MERGE INTO DEV_DB.HISTORY_DNA.HISTORY_INVENTORY_TRANSACTION T USING DEV_DB.CLEANSED_DNA.CLEANSED_INVENTORY_TRANSACTION S
    ON T.HASH_KEY = S.HASH_KEY -- match on key
WHEN MATCHED AND T.HASH_ADDRESS != S.HASH_ADDRESS THEN -- data has changed
UPDATE SET
    T.HASH_ADDRESS = S.HASH_ADDRESS,
    T.TM_FISCAL_YEAR = S.TM_FISCAL_YEAR,
    T.MONTH_NAME = S.MONTH_NAME,
    T.MONTH = S.MONTH,
    T.PARTNER_TYPE = S.PARTNER_TYPE,
    T.DEALER = S.DEALER,
    T.DEALER_CODE = S.DEALER_CODE,
    T.DIVISION = S.DIVISION,
    T.REGION = S.REGION,
    T.JOB_CARD_NUMBER = S.JOB_CARD_NUMBER,
    T.JOB_CARD_CREATED_DATE = S.JOB_CARD_CREATED_DATE,
    T.JC_OPEN_DAYS = S.JC_OPEN_DAYS,
    T.JOB_CARD_CLOSED_DATE = S.JOB_CARD_CLOSED_DATE,
    T.SERVICE_TYPE = S.SERVICE_TYPE,
    T.KMS_RUN = S.KMS_RUN,
    T.PART_NO = S.PART_NO,
    T.PART_DESC = S.PART_DESC,
    T.CATEGORY = S.CATEGORY,
    T.TM_PART_INDICATOR = S.TM_PART_INDICATOR,
    T.SOLD_QTY = S.SOLD_QTY,
    T.TM_SPARES_AMOUNT = S.TM_SPARES_AMOUNT,
    T.SPARES_AMOUNT = S.SPARES_AMOUNT,
    T.PPL = S.PPL,
    T.PL = S.PL,
    T.LOB = S.LOB,
    T.INVOICE_STATUS = S.INVOICE_STATUS,
    T.INVOICE_NUMBER = S.INVOICE_NUMBER,
    T.INVOICE_DATE = S.INVOICE_DATE,
    T.LIQUID_FLAG  = S.LIQUID_FLAG,
    T.MODIFIED_DATE = S.MODIFIED_DATE
WHEN NOT MATCHED THEN -- new data
INSERT(
    HASH_KEY,
    HASH_ADDRESS,
    TM_FISCAL_YEAR,
    MONTH_NAME,
    MONTH,
    PARTNER_TYPE,
    DEALER,
    DEALER_CODE,
    DIVISION,
    REGION,
    JOB_CARD_NUMBER,
    JOB_CARD_CREATED_DATE,
    JC_OPEN_DAYS,
    JOB_CARD_CLOSED_DATE,
    SERVICE_TYPE,
    KMS_RUN,
    PART_NO,
    PART_DESC,
    CATEGORY,
    TM_PART_INDICATOR,
    SOLD_QTY,
    TM_SPARES_AMOUNT,
    SPARES_AMOUNT,
    PPL,
    PL,
    LOB,
    INVOICE_STATUS,
    INVOICE_NUMBER,
    INVOICE_DATE,
    LIQUID_FLAG,
    CREATED_DATE,
    MODIFIED_DATE

)
VALUES(
    S.HASH_KEY,
    S.HASH_ADDRESS,
    S.TM_FISCAL_YEAR,
    S.MONTH_NAME,
    S.MONTH,
    S.PARTNER_TYPE,
    S.DEALER,
    S.DEALER_CODE,
    S.DIVISION,
    S.REGION,
    S.JOB_CARD_NUMBER,
    S.JOB_CARD_CREATED_DATE,
    S.JC_OPEN_DAYS,
    S.JOB_CARD_CLOSED_DATE,
    S.SERVICE_TYPE,
    S.KMS_RUN,
    S.PART_NO,
    S.PART_DESC,
    S.CATEGORY,
    S.TM_PART_INDICATOR,
    S.SOLD_QTY,
    S.TM_SPARES_AMOUNT,
    S.SPARES_AMOUNT,
    S.PPL,
    S.PL,
    S.LOB,
    S.INVOICE_STATUS,
    S.INVOICE_NUMBER,
    S.INVOICE_DATE,
    S.LIQUID_FLAG,
    S.CREATED_DATE,
    S.MODIFIED_DATE
);